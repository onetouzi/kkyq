<!DOCTYPE html>
<link rel="stylesheet" href="https://cdn.bootcdn.net/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css">
<link rel="stylesheet" href="https://cdn.bootcdn.net/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<link rel="stylesheet" href="https://cdn.bootcdn.net/ajax/libs/bootstrap-datepicker/1.9.0/css/bootstrap-datepicker.min.css">

<script src="https://cdn.bootcdn.net/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
<script src="https://cdn.bootcdn.net/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js"></script>
<script src="https://cdn.bootcdn.net/ajax/libs/bootstrap-datepicker/1.9.0/js/bootstrap-datepicker.min.js"></script>
<script src="https://cdn.bootcdn.net/ajax/libs/bootstrap-datepicker/1.9.0/locales/bootstrap-datepicker.zh-CN.min.js"></script>
<html lang="zh" xmlns:th="http://www.thymeleaf.org" >
<head>
    <th:block th:include="include :: header('新增读者书籍借阅关系')" />
    <th:block th:include="include :: datetimepicker-css" />
</head>
<body class="white-bg">
    <div class="wrapper wrapper-content animated fadeInRight ibox-content">
        <form class="form-horizontal m" id="form-record-add">
            <div class="col-xs-12">
                <div class="form-group">
                    <label class="col-sm-3 control-label is-required">读者编号：</label>
                    <div class="col-sm-8">
                        <input name="readerNo" class="form-control" type="text" required>
                    </div>
                </div>
            </div>
            <div class="col-xs-12">
                <div class="form-group">
                    <label class="col-sm-3 control-label is-required">读者姓名，冗余存储提升查询效率：</label>
                    <div class="col-sm-8">
                        <input name="readerName" class="form-control" type="text" required>
                    </div>
                </div>
            </div>
            <div class="col-xs-12">
                <div class="form-group">
                    <label class="col-sm-3 control-label">书籍编号：</label>
                    <div class="col-sm-8">
                        <input name="bookNo" class="form-control" type="text">
                    </div>
                </div>
            </div>
            <div class="col-xs-12">
                <div class="form-group">
                    <label class="col-sm-3 control-label is-required">书籍名称：</label>
                    <div class="col-sm-8">
                        <input name="bookName" class="form-control" type="text" required>
                    </div>
                </div>
            </div>
            <div class="col-xs-12">
                <div class="form-group">
                    <label class="col-sm-3 control-label is-required">借阅时间：</label>
                    <div class="col-sm-8">
                        <div class="input-group date" id="borrowTimePicker">
                            <input name="borrowTime" class="form-control" placeholder="yyyy-MM-dd" type="text" required>
                            <span class="input-group-addon"><i class="fa fa-calendar"></i></span>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-xs-12">
                <div class="form-group">
                    <label class="col-sm-3 control-label">归还时间：</label>
                    <div class="col-sm-8">
                        <div class="input-group date" id="returnTimePicker">
                            <input name="returnTime" class="form-control" placeholder="yyyy-MM-dd" type="text">
                            <span class="input-group-addon"><i class="fa fa-calendar"></i></span>
                        </div>
                    </div>
                </div>
            </div>

            <th:block th:include="include :: footer" />
    <th:block th:include="include :: datetimepicker-js" />
    <script th:inline="javascript">
        var prefix = ctx + "work/record"
        $("#form-record-add").validate({
            focusCleanup: true
        });

        function submitHandler() {
            if ($.validate.form()) {
                $.operate.save(prefix + "/add", $('#form-record-add').serialize());
            }
        }

        $("input[name='borrowTime']").datetimepicker({
            format: "yyyy-mm-dd",
            minView: "month",
            autoclose: true
        });

        $("input[name='returnTime']").datetimepicker({
            format: "yyyy-mm-dd",
            minView: "month",
            autoclose: true
        });
        $(function() {
            // 1. 日历插件全局配置（固定格式+中文+自动选今日）
            var dateOptions = {
                format: "yyyy-mm-dd",
                language: "zh-CN",
                autoclose: true,
                todayHighlight: true,
                todayBtn: "linked"
            };

            // 2. 初始化借阅/归还时间日历插件
            var borrowPicker = $(".input-group.date").eq(0).datepicker(dateOptions);
            var returnPicker = $(".input-group.date").eq(1).datepicker(dateOptions);

            // 3. 日期格式化工具：转成 yyyy-MM-dd 格式
            function formatCurrDate(addDay = 0) {
                let d = new Date();
                d.setDate(d.getDate() + addDay);
                let y = d.getFullYear();
                let m = (d.getMonth() + 1).toString().padStart(2, "0");
                let day = d.getDate().toString().padStart(2, "0");
                return `${y}-${m}-${day}`;
            }

            // 4. 核心赋值：借阅=今日，归还=今日+7天，同步日历选中状态
            const today = formatCurrDate(0); // 当前时间
            const return7Day = formatCurrDate(7); // 7天后

            // 借阅时间赋值 + 日历高亮选中
            $("input[name='borrowTime']").val(today);
            borrowPicker.datepicker("setDate", today);

            // 归还时间赋值 + 日历高亮选中
            $("input[name='returnTime']").val(return7Day);
            returnPicker.datepicker("setDate", return7Day);
        });
        todayBtn: "linked";
    </script>
</body>
</html>